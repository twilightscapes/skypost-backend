<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Floating Notes - Local Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #667eea;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #666;
      margin-bottom: 2rem;
    }

    .instructions {
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 4px;
    }

    .instructions h3 {
      margin-top: 0;
      color: #667eea;
    }

    .instructions ol {
      margin-left: 1.5rem;
    }

    .instructions li {
      margin-bottom: 0.5rem;
      color: #333;
    }

    .note {
      background: #fef3cd;
      border-left: 4px solid #ffc107;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
      color: #333;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
      font-size: 1rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #333;
    }

    .btn-secondary:hover {
      opacity: 0.9;
    }

    .demo-panel {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f9fafb;
      border-radius: 8px;
      border: 2px dashed #667eea;
    }

    .demo-panel h3 {
      color: #667eea;
      margin-top: 0;
    }

    #demoNotesPanel {
      display: none;
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 350px;
      max-height: 500px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      flex-direction: column;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      z-index: 999999;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px 12px 0 0;
      color: white;
    }

    .panel-header h3 {
      margin: 0;
      font-size: 1rem;
    }

    .close-btn {
      background: transparent;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: #f9fafb;
    }

    .panel-input-group {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      border-top: 1px solid #e5e7eb;
    }

    .panel-input-group input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
    }

    .panel-input-group button {
      padding: 0.5rem 1rem;
      background: #667eea;
      color: white;
    }

    .note-item {
      background: white;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .note-text {
      flex: 1;
      font-size: 0.9rem;
      word-break: break-word;
    }

    .note-delete {
      background: transparent;
      border: none;
      color: #ef4444;
      font-size: 1.25rem;
      cursor: pointer;
      padding: 0;
    }

    .code-block {
      background: #1f2937;
      color: #e5e7eb;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Floating Notes Safari Extension</h1>
    <p class="subtitle">Test the floating notes panel locally before installing in Safari</p>

    <div class="instructions">
      <h3>‚úÖ Local Testing Steps:</h3>
      <ol>
        <li>Click "Demo: Toggle Notes Panel" below to see how the extension works</li>
        <li>Add some test notes to understand the functionality</li>
        <li>Once satisfied, follow the Safari installation steps below</li>
      </ol>
    </div>

    <h2>üì± Safari Installation (Local Testing)</h2>
    
    <div class="instructions">
      <h3>Step 1: Enable Developer Mode in Safari</h3>
      <ol>
        <li>Open Safari</li>
        <li>Go to <strong>Safari ‚Üí Preferences ‚Üí Advanced</strong></li>
        <li>Check the box: <strong>"Show Develop menu in menu bar"</strong></li>
        <li>Close Preferences</li>
      </ol>
    </div>

    <div class="instructions">
      <h3>Step 2: Allow Unsigned Extensions</h3>
      <ol>
        <li>Click <strong>Develop ‚Üí Allow Unsigned Extensions</strong></li>
        <li>This enables local testing (expires when Safari restarts)</li>
      </ol>
    </div>

    <div class="instructions">
      <h3>Step 3: Load the Extension</h3>
      <ol>
        <li>Go to <strong>Develop ‚Üí Manage Extensions</strong></li>
        <li>Click the <strong>+</strong> button at the bottom-left</li>
        <li>Navigate to your project folder: <code>safari-extension/dist</code></li>
        <li>Select the manifest.json file</li>
        <li>Click <strong>Open</strong></li>
      </ol>
    </div>

    <div class="instructions">
      <h3>Step 4: Enable the Extension</h3>
      <ol>
        <li>In Extensions panel, find "Floating Notes"</li>
        <li>Toggle it ON</li>
        <li>Choose where to allow it (This Website, All Websites, etc.)</li>
      </ol>
    </div>

    <div class="note">
      <strong>üí° Tip:</strong> You can reload the extension by pressing Cmd+R in Safari after making code changes. For persistent installation, you'll need to sign it with Xcode or join Apple's Developer Program.
    </div>

    <h2>üß™ Test Demo</h2>
    
    <div class="demo-panel">
      <h3>Try the Notes Panel</h3>
      <p>Click the button below to see a working demo of the floating notes panel:</p>
      <div class="button-group">
        <button class="btn-primary" onclick="toggleDemoPanel()">Demo: Toggle Notes Panel</button>
        <button class="btn-secondary" onclick="clearDemoNotes()">Clear Demo Notes</button>
      </div>
    </div>

    <h2>üîß Build & Package</h2>
    
    <p>To prepare the extension for Safari:</p>
    
    <div class="code-block">
cd safari-extension
bash build.sh
    </div>

    <p>This creates a <code>dist</code> folder with all necessary files ready for Safari to load.</p>

    <h2>‚ùì FAQ</h2>
    
    <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
      <h3 style="margin-top: 0;">Q: Why does the extension disappear when I restart Safari?</h3>
      <p>A: Unsigned extensions only work when "Allow Unsigned Extensions" is enabled. Re-enable it in the Develop menu after restarting Safari.</p>

      <h3>Q: How do I use the extension?</h3>
      <p>A: Press <strong>Cmd+Shift+N</strong> on any website to toggle the notes panel. Your notes persist across all websites.</p>

      <h3>Q: Where are my notes stored?</h3>
      <p>A: Notes are stored in your browser's IndexedDB. They're completely local and never sent to any server.</p>

      <h3>Q: Can I distribute this officially?</h3>
      <p>A: To distribute through the Safari App Store, you'll need to sign it with an Apple Developer certificate and go through Apple's review process.</p>
    </div>

    <h2>üìö Next Steps</h2>
    
    <ul>
      <li>‚úÖ Test the local demo below</li>
      <li>‚¨ú Follow Safari installation steps above</li>
      <li>‚¨ú Test on actual websites with the keyboard shortcut</li>
      <li>‚¨ú Add features (colors, rich text, etc.)</li>
      <li>‚¨ú Create Chrome extension version</li>
      <li>‚¨ú Create Firefox extension version</li>
    </ul>
  </div>

  <!-- Demo Notes Panel -->
  <div id="demoNotesPanel">
    <div class="panel-header">
      <h3>Notes</h3>
      <button class="close-btn" onclick="toggleDemoPanel()">√ó</button>
    </div>
    <div class="panel-content" id="demoPanelContent"></div>
    <div class="panel-input-group">
      <input type="text" id="demoInput" placeholder="Add a note..." />
      <button onclick="addDemoNote()">Add</button>
    </div>
  </div>

  <script>
    // Simple IndexedDB wrapper for demo
    class DemoNotesDB {
      constructor() {
        this.db = null;
        this.init();
      }

      init() {
        const request = indexedDB.open('FloatingNotesDemo', 1);
        request.onerror = () => console.error('IndexedDB error');
        request.onsuccess = () => {
          this.db = request.result;
        };
        request.onupgradeneeded = (e) => {
          const db = e.target.result;
          if (!db.objectStoreNames.contains('notes')) {
            db.createObjectStore('notes', { keyPath: 'id' });
          }
        };
      }

      async saveNote(note) {
        return new Promise((resolve) => {
          const transaction = this.db.transaction(['notes'], 'readwrite');
          const store = transaction.objectStore('notes');
          store.put(note);
          transaction.oncomplete = () => resolve();
        });
      }

      async getAllNotes() {
        return new Promise((resolve) => {
          const transaction = this.db.transaction(['notes'], 'readonly');
          const store = transaction.objectStore('notes');
          const request = store.getAll();
          request.onsuccess = () => resolve(request.result || []);
        });
      }

      async deleteNote(id) {
        return new Promise((resolve) => {
          const transaction = this.db.transaction(['notes'], 'readwrite');
          const store = transaction.objectStore('notes');
          store.delete(id);
          transaction.oncomplete = () => resolve();
        });
      }

      async clearAll() {
        return new Promise((resolve) => {
          const transaction = this.db.transaction(['notes'], 'readwrite');
          const store = transaction.objectStore('notes');
          store.clear();
          transaction.oncomplete = () => resolve();
        });
      }
    }

    const demoDb = new DemoNotesDB();

    async function toggleDemoPanel() {
      const panel = document.getElementById('demoNotesPanel');
      if (panel.style.display === 'flex') {
        panel.style.display = 'none';
      } else {
        panel.style.display = 'flex';
        await renderDemoNotes();
        document.getElementById('demoInput').focus();
      }
    }

    async function addDemoNote() {
      const input = document.getElementById('demoInput');
      const text = input.value.trim();
      if (!text) return;

      const note = {
        id: Date.now().toString(),
        content: text,
        createdAt: Date.now(),
      };

      await demoDb.saveNote(note);
      input.value = '';
      await renderDemoNotes();
    }

    async function renderDemoNotes() {
      const notes = await demoDb.getAllNotes();
      const content = document.getElementById('demoPanelContent');
      
      if (notes.length === 0) {
        content.innerHTML = '<p style="color: #9ca3af; text-align: center; margin-top: 2rem;">No posts yet</p>';
        return;
      }

      content.innerHTML = notes.map(note => `
        <div class="note-item">
          <span class="note-text">${escapeHtml(note.content)}</span>
          <button class="note-delete" onclick="deleteDemoNote('${note.id}')">√ó</button>
        </div>
      `).join('');
    }

    async function deleteDemoNote(id) {
      await demoDb.deleteNote(id);
      await renderDemoNotes();
    }

    async function clearDemoNotes() {
      if (confirm('Clear all demo notes?')) {
        await demoDb.clearAll();
        await renderDemoNotes();
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Keyboard shortcut for demo
    document.addEventListener('keydown', (e) => {
      const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
      const modKey = isMac ? e.metaKey : e.ctrlKey;
      if (modKey && e.shiftKey && e.key === 'N') {
        e.preventDefault();
        toggleDemoPanel();
      }
    });
  </script>
</body>
</html>
